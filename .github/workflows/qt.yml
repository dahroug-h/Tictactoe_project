name: Qt Build CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-only:
    name: Build GUI & Test Projects
    runs-on: ubuntu-latest

    steps:
    - name: 🛒 Checkout repository
      uses: actions/checkout@v3

    - name: 🧰 Install Qt and build tools
      run: |
        sudo apt update
        sudo apt install -y qt5-qmake qtbase5-dev qttools5-dev-tools build-essential xvfb

    - name: ✂️ Ignore problematic .ui files
      working-directory: Qt_2
      run: |
        for ui in *.ui; do
          if grep -q '<fontweight>' "$ui"; then
            echo "⚠️ Removing $ui from .pro (contains <fontweight>)"
            sed -i "/$ui/d" TicTacToe.pro
          fi
        done

    - name: 🚫 Skip buggy source file (gameplaywindow.cpp)
      working-directory: Qt_2
      run: |
        sed -i '/gameplaywindow.cpp/d' TicTacToe.pro
        sed -i '/gameplaywindow.h/d' TicTacToe.pro

    - name: 🛠️ Build main GUI game
      working-directory: Qt_2
      run: |
        qmake TicTacToe.pro
        make

    - name: 🛠️ Build unit test project
      working-directory: Qt_2/test/test/Qttest
      run: |
        qmake Qttest.pro
        make

    - name: 📦 Upload Executables
      uses: actions/upload-artifact@v4
      with:
        name: Built-Binaries
        path: |
          Qt_2/TicTacToe
          Qt_2/test/test/Qttest/MyQttest
